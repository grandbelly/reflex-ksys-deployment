# WebSocket ë¹ ë¥¸ í•´ê²° ê°€ì´ë“œ âš¡

## í˜„ì¬ ë¬¸ì œ

```
Cannot connect to server: timeout
wss://ksys.idna.ai.kr/_event
```

## 1ë¶„ í•´ê²°ë²• ğŸš€

### Cloudflare Dashboard ì„¤ì • (í•„ìˆ˜!)

Token ê¸°ë°˜ í„°ë„ì€ **Cloudflare Dashboardì—ì„œë§Œ** ingress ê·œì¹™ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 1ë‹¨ê³„: Dashboard ì ‘ì†

https://one.dash.cloudflare.com â†’ **Networks** â†’ **Tunnels**

#### 2ë‹¨ê³„: í„°ë„ ì„ íƒ

í˜„ì¬ í„°ë„ í´ë¦­ (HEALTHY ìƒíƒœ)

#### 3ë‹¨ê³„: Public Hostname ì„¤ì •

**Configure** íƒ­ â†’ **Public Hostname** ì„¹ì…˜

í˜„ì¬ 1ê°œë§Œ ìˆì„ ê²ƒì…ë‹ˆë‹¤:
```
ksys.idna.ai.kr â†’ http://reflex-app-prod:13000
```

#### 4ë‹¨ê³„: ë°±ì—”ë“œ ë¼ìš°íŒ… ì¶”ê°€ â­

**"Add a public hostname"** í´ë¦­

```yaml
Public hostname:
  Subdomain: ksys
  Domain: idna.ai.kr
  Path: /_event          # ì´ê²ƒì´ í•µì‹¬!

Service:
  Type: HTTP
  URL: reflex-app-prod:13001

Additional application settings:
  âœ… Enable WebSocket support (ë°˜ë“œì‹œ ì²´í¬!)
```

#### 5ë‹¨ê³„: ê¸°ì¡´ ê·œì¹™ë„ WebSocket í™œì„±í™”

ê¸°ì¡´ `ksys.idna.ai.kr` ê·œì¹™ **Edit** í´ë¦­:

```yaml
Additional application settings:
  âœ… Enable WebSocket support (ì²´í¬!)
```

**Save** í´ë¦­

#### 6ë‹¨ê³„: ìˆœì„œ í™•ì¸ (ì¤‘ìš”!)

Public Hostname ëª©ë¡ì—ì„œ **ìˆœì„œ í™•ì¸**:

```
1ìˆœìœ„: ksys.idna.ai.kr  Path: /_event    â†’ reflex-app-prod:13001 âœ…
2ìˆœìœ„: ksys.idna.ai.kr  Path: (empty)    â†’ reflex-app-prod:13000 âœ…
```

ìˆœì„œê°€ ì˜ëª»ë˜ì—ˆë‹¤ë©´ ë“œë˜ê·¸í•´ì„œ **/_eventê°€ ìœ„ë¡œ** ì´ë™!

#### 7ë‹¨ê³„: ì™„ë£Œ!

1-2ë¶„ ëŒ€ê¸° í›„ https://ksys.idna.ai.kr ìƒˆë¡œê³ ì¹¨

---

## ì„¤ì • ìŠ¤í¬ë¦°ìƒ· ê°€ì´ë“œ

### Public Hostname #1 (/_event)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Public hostname                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Subdomain:  ksys                         â”‚
â”‚ Domain:     idna.ai.kr                   â”‚
â”‚ Path:       /_event                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type:  HTTP                              â”‚
â”‚ URL:   reflex-app-prod:13001             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Additional application settings          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ Enable WebSocket support              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Public Hostname #2 (main app)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Public hostname                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Subdomain:  ksys                         â”‚
â”‚ Domain:     idna.ai.kr                   â”‚
â”‚ Path:       (ë¹„ì›Œë‘ê¸°)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Service                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type:  HTTP                              â”‚
â”‚ URL:   reflex-app-prod:13000             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Additional application settings          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ Enable WebSocket support              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í™•ì¸ ë°©ë²•

### ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬

1. `F12` í‚¤ ëˆ„ë¥´ê¸°
2. **Network** íƒ­
3. **WS** (WebSocket) í•„í„° í´ë¦­
4. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (`Ctrl+F5`)

**ì„±ê³µ ì‹œ:**
```
Name: _event
Status: 101 Switching Protocols
Type: websocket
âœ… ì´ˆë¡ìƒ‰ í‘œì‹œ
```

**ì‹¤íŒ¨ ì‹œ:**
```
Name: _event
Status: (failed)
âŒ ë¹¨ê°„ìƒ‰ í‘œì‹œ
```

### Console í…ŒìŠ¤íŠ¸

ê°œë°œì ë„êµ¬ â†’ **Console** íƒ­:

```javascript
new WebSocket('wss://ksys.idna.ai.kr/_event').onopen = () => console.log('âœ… OK')
```

**ì„±ê³µ:** `âœ… OK` ì¶œë ¥
**ì‹¤íŒ¨:** ì—ëŸ¬ ë©”ì‹œì§€

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

ì„¤ì • ì™„ë£Œ í›„:

- [ ] Cloudflare Dashboard ì ‘ì†
- [ ] Public Hostname 2ê°œ ìƒì„±
  - [ ] `/_event` â†’ `reflex-app-prod:13001`
  - [ ] `/` â†’ `reflex-app-prod:13000`
- [ ] ë‘ ê·œì¹™ ëª¨ë‘ **WebSocket í™œì„±í™”**
- [ ] `/_event` ê·œì¹™ì´ **ìœ„ì—** ìˆëŠ”ì§€ í™•ì¸
- [ ] ì €ì¥ ì™„ë£Œ
- [ ] 1-2ë¶„ ëŒ€ê¸°
- [ ] í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (`Ctrl+F5`)
- [ ] WebSocket ì—°ê²° í™•ì¸ (ê°œë°œì ë„êµ¬)
- [ ] ì—ëŸ¬ ë©”ì‹œì§€ ì‚¬ë¼ì§ í™•ì¸

---

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Q: Dashboardì—ì„œ Path ì˜µì…˜ì´ ì•ˆ ë³´ì—¬ìš”
**A:** "Advanced" ë˜ëŠ” "Additional settings" í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°

### Q: WebSocket ì˜µì…˜ì´ ì•ˆ ë³´ì—¬ìš”
**A:** Service ì„¤ì •ì—ì„œ Typeì„ **HTTP** (HTTPS ì•„ë‹˜)ë¡œ ì„ íƒ

### Q: ì €ì¥í–ˆëŠ”ë° ì•ˆ ë°”ë€Œì–´ìš”
**A:**
1. ë¸Œë¼ìš°ì € ìºì‹œ í´ë¦¬ì–´ (`Ctrl+Shift+Delete`)
2. ì‹œí¬ë¦¿ ëª¨ë“œë¡œ í…ŒìŠ¤íŠ¸
3. Cloudflare Dashboardì—ì„œ ì„¤ì • ë‹¤ì‹œ í™•ì¸

### Q: ì—¬ì „íˆ timeout ë‚˜ì™€ìš”
**A:**
```bash
# í„°ë„ ì¬ì‹œì‘
docker restart cloudflared-tunnel-prod

# ë¡œê·¸ í™•ì¸
docker logs cloudflared-tunnel-prod --tail 20

# ì•± ì¬ì‹œì‘
docker restart reflex-ksys-app-prod
```

---

## ì™œ Config íŒŒì¼ì´ ì•ˆ ë¨¹í˜€ìš”?

Token ê¸°ë°˜ í„°ë„(`--token` ì‚¬ìš©)ì€ **Cloudflare Dashboardì˜ ì„¤ì •ì´ ìš°ì„ **ì…ë‹ˆë‹¤.

Config íŒŒì¼ì€ **Credentials ê¸°ë°˜**ì—ì„œë§Œ ì™„ì „íˆ ì‘ë™í•©ë‹ˆë‹¤.

í˜„ì¬ ì„¤ì •:
```yaml
# Token ê¸°ë°˜ (Dashboard ìš°ì„ )
command: tunnel --token XXX

# ConfigëŠ” ì°¸ê³ ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©ë¨
--config /etc/cloudflared/config.yml
```

**í•´ê²°:** Dashboardì—ì„œ ì§ì ‘ ì„¤ì •!

---

## ì˜ˆìƒ ê²°ê³¼

### Before (í˜„ì¬)
```
âŒ Cannot connect to server: timeout
âŒ wss:// ì—°ê²° ì‹¤íŒ¨
âŒ ì‹¤ì‹œê°„ ë°ì´í„° ì—†ìŒ
âŒ ë¹¨ê°„ ì—ëŸ¬ ë°•ìŠ¤
```

### After (ì„¤ì • í›„)
```
âœ… WebSocket ì—°ê²° ì„±ê³µ
âœ… ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸
âœ… ì—ëŸ¬ ë©”ì‹œì§€ ì‚¬ë¼ì§
âœ… ë¶€ë“œëŸ¬ìš´ UI ì—…ë°ì´íŠ¸
```

---

## í•µì‹¬ ìš”ì•½

**3ë‹¨ê³„ í•´ê²°:**

1. **Cloudflare Dashboard** ì ‘ì†
2. **Public Hostname ì¶”ê°€:** `/_event` â†’ `reflex-app-prod:13001`
3. **WebSocket í™œì„±í™”** (ë‘ ê·œì¹™ ëª¨ë‘)

**ì†Œìš” ì‹œê°„:** 2-3ë¶„
**ë‚œì´ë„:** â­â˜†â˜†â˜†â˜†

ì´ì œ ì‹¤ì‹œê°„ ë°ì´í„°ê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤! ğŸ‰
